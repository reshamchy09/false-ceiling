<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Management Dashboard</title>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-bottom: 1rem;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .nav-menu {
            list-style: none;
            padding: 0 1rem;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: #4a5568;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-link:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover:before {
            left: 100%;
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(8px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .page {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card:hover:before {
            transform: scaleX(1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .card-description {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        /* Tables */
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .table tbody tr {
            transition: background-color 0.2s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.05);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Status badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Dashboard specific styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #374151;
        }

        /* Toggle Button for Sidebar */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1002;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: block;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Pulse animation for cards */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }

        .card-animated {
            animation: pulse 2s infinite;
        }

        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Login Modal */
        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="login-modal" id="loginModal">
        <div class="modal-content">
            <h2>Login to Business Pro</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter email" aria-label="Email" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter password" aria-label="Password" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Login">Login</button>
                <button type="button" class="btn btn-secondary" id="signupButton" aria-label="Sign Up">Sign Up</button>
            </form>
        </div>
    </div>

    <button class="sidebar-toggle" aria-label="Toggle Sidebar">‚ò∞</button>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Business Pro</h2>
                <button class="btn btn-secondary" id="logoutButton" style="margin-top: 1rem;" aria-label="Logout">Logout</button>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard" aria-label="Dashboard">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="inventory" aria-label="Inventory">
                        <span class="nav-icon">üì¶</span>
                        Inventory
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="sales" aria-label="Sales">
                        <span class="nav-icon">üí∞</span>
                        Sales
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="customers" aria-label="Customers">
                        <span class="nav-icon">üë•</span>
                        Customers
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="employees" aria-label="Employees">
                        <span class="nav-icon">üë§</span>
                        Employees
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="invoice" aria-label="Invoice and Billing">
                        <span class="nav-icon">üìÑ</span>
                        Invoice & Billing
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="purchase" aria-label="Purchase">
                        <span class="nav-icon">üõí</span>
                        Purchase
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="expense" aria-label="Expense">
                        <span class="nav-icon">üí∏</span>
                        Expense
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="tasks" aria-label="Task Assignment">
                        <span class="nav-icon">‚úÖ</span>
                        Task Assignment
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="payments" aria-label="Payment Track">
                        <span class="nav-icon">üí≥</span>
                        Payment Track
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="website" aria-label="Website Management">
                        <span class="nav-icon">üåê</span>
                        Website Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="ledger" aria-label="Ledger">
                        <span class="nav-icon">üìö</span>
                        Ledger
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="settings" aria-label="Settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        Settings
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome to your business overview</p>
                </div>

                <div class="stats-grid">
                    <div class="card card-animated">
                        <div class="card-header">
                            <div class="card-icon">üí∞</div>
                            <div class="card-title">Total Revenue</div>
                        </div>
                        <div class="card-value" id="totalRevenue">$0</div>
                        <div class="card-description">+12% from last month</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üì¶</div>
                            <div class="card-title">Products</div>
                        </div>
                        <div class="card-value" id="totalProducts">0</div>
                        <div class="card-description">Items in inventory</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üë•</div>
                            <div class="card-title">Customers</div>
                        </div>
                        <div class="card-value" id="totalCustomers">0</div>
                        <div class="card-description">Active customers</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìä</div>
                            <div class="card-title">Orders</div>
                        </div>
                        <div class="card-value" id="totalOrders">0</div>
                        <div class="card-description">This month</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Sales Overview</h3>
                    <canvas id="salesChart" height="300"></canvas>
                </div>
            </div>

            <!-- Inventory Page -->
            <div id="inventory" class="page">
                <div class="page-header">
                    <h1 class="page-title">Inventory Management</h1>
                    <p class="page-subtitle">Manage your products and stock levels</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddProductForm()" aria-label="Add New Product">
                            ‚ûï Add New Product
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚ö†Ô∏è</div>
                            <div class="card-title">Low Stock Alert</div>
                        </div>
                        <div class="card-value" id="lowStockCount">0</div>
                        <div class="card-description">Items need restocking</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Product Inventory</h3>
                    <table class="table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Page -->
            <div id="sales" class="page">
                <div class="page-header">
                    <h1 class="page-title">Sales Management</h1>
                    <p class="page-subtitle">Track and manage all sales activities</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìà</div>
                            <div class="card-title">Today's Sales</div>
                        </div>
                        <div class="card-value" id="todaySales">$0</div>
                        <div class="card-description" id="todayTransactions">0 transactions</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üéØ</div>
                            <div class="card-title">Monthly Target</div>
                        </div>
                        <div class="card-value" id="monthlyTarget">0%</div>
                        <div class="card-description">$0 / $100,000</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Recent Sales</h3>
                    <table class="table" id="salesTable">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Customers Page -->
            <div id="customers" class="page">
                <div class="page-header">
                    <h1 class="page-title">Customer Management</h1>
                    <p class="page-subtitle">Manage customer relationships and data</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddCustomerForm()" aria-label="Add New Customer">
                            ‚ûï Add New Customer
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚≠ê</div>
                            <div class="card-title">VIP Customers</div>
                        </div>
                        <div class="card-value" id="vipCustomers">0</div>
                        <div class="card-description">Premium members</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Customer Database</h3>
                    <table class="table" id="customersTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Total Orders</th>
                                <th>Last Order</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Employees Page -->
            <div id="employees" class="page">
                <div class="page-header">
                    <h1 class="page-title">Employee Management</h1>
                    <p class="page-subtitle">Manage your team and workforce</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddEmployeeForm()" aria-label="Add New Employee">
                            ‚ûï Add New Employee
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üë•</div>
                            <div class="card-title">Total Employees</div>
                        </div>
                        <div class="card-value" id="totalEmployees">0</div>
                        <div class="card-description">Active staff members</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Employee Directory</h3>
                    <table class="table" id="employeesTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Department</th>
                                <th>Email</th>
                                <th>Hire Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Invoice & Billing Page -->
            <div id="invoice" class="page">
                <div class="page-header">
                    <h1 class="page-title">Invoice & Billing</h1>
                    <p class="page-subtitle">Create and manage invoices and billing</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddInvoiceForm()" aria-label="Create New Invoice">
                            ‚ûï Create New Invoice
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí∞</div>
                            <div class="card-title">Outstanding</div>
                        </div>
                        <div class="card-value" id="outstandingInvoices">$0</div>
                        <div class="card-description">Pending payments</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Recent Invoices</h3>
                    <table class="table" id="invoicesTable">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Purchase Page -->
            <div id="purchase" class="page">
                <div class="page-header">
                    <h1 class="page-title">Purchase Management</h1>
                    <p class="page-subtitle">Manage supplier orders and purchases</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddPurchaseForm()" aria-label="Create Purchase Order">
                            ‚ûï Create Purchase Order
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üì¶</div>
                            <div class="card-title">Pending Orders</div>
                        </div>
                        <div class="card-value" id="pendingOrders">0</div>
                        <div class="card-description">Awaiting delivery</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Purchase Orders</h3>
                    <table class="table" id="purchasesTable">
                        <thead>
                            <tr>
                                <th>PO Number</th>
                                <th>Supplier</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Expected Delivery</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Expense Page -->
            <div id="expense" class="page">
                <div class="page-header">
                    <h1 class="page-title">Expense Management</h1>
                    <p class="page-subtitle">Track and categorize business expenses</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddExpenseForm()" aria-label="Add New Expense">
                            ‚ûï Add New Expense
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí∏</div>
                            <div class="card-title">Monthly Expenses</div>
                        </div>
                        <div class="card-value" id="monthlyExpenses">$0</div>
                        <div class="card-description">This month's total</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Recent Expenses</h3>
                    <table class="table" id="expensesTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Payment Method</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Task Assignment Page -->
            <div id="tasks" class="page">
                <div class="page-header">
                    <h1 class="page-title">Task Assignment</h1>
                    <p class="page-subtitle">Assign and track team tasks</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddTaskForm()" aria-label="Create New Task">
                            ‚ûï Create New Task
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚è∞</div>
                            <div class="card-title">Overdue Tasks</div>
                        </div>
                        <div class="card-value" id="overdueTasks">0</div>
                        <div class="card-description">Need attention</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Active Tasks</h3>
                    <table class="table" id="tasksTable">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Assigned To</th>
                                <th>Priority</th>
                                <th>Due Date</th>
                                <th>Progress</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Payment Track Page -->
            <div id="payments" class="page">
                <div class="page-header">
                    <h1 class="page-title">Payment Tracking</h1>
                    <p class="page-subtitle">Monitor incoming and outgoing payments</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <button class="btn btn-primary" onclick="showAddPaymentForm()" aria-label="Record Payment">
                            ‚ûï Record Payment
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí≥</div>
                            <div class="card-title">Pending Payments</div>
                        </div>
                        <div class="card-value" id="pendingPayments">$0</div>
                        <div class="card-description">Awaiting processing</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Payment History</h3>
                    <table class="table" id="paymentsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Reference</th>
                                <th>Customer/Supplier</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Website Management Page -->
            <div id="website" class="page">
                <div class="page-header">
                    <h1 class="page-title">Website Management</h1>
                    <p class="page-subtitle">Manage your online presence</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üëÅÔ∏è</div>
                            <div class="card-title">Monthly Visitors</div>
                        </div>
                        <div class="card-value" id="monthlyVisitors">0</div>
                        <div class="card-description">+18% from last month</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üõí</div>
                            <div class="card-title">Conversion Rate</div>
                        </div>
                        <div class="card-value" id="conversionRate">0%</div>
                        <div class="card-description">Online sales conversion</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Content Management</h3>
                    <table class="table" id="websiteTable">
                        <thead>
                            <tr>
                                <th>Page</th>
                                <th>Last Updated</th>
                                <th>Views</th>
                                <th>Status</th>
                                <th>SEO Score</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Ledger Page -->
            <div id="ledger" class="page">
                <div class="page-header">
                    <h1 class="page-title">General Ledger</h1>
                    <p class="page-subtitle">Complete financial transaction records</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí∞</div>
                            <div class="card-title">Total Assets</div>
                        </div>
                        <div class="card-value" id="totalAssets">$0</div>
                        <div class="card-description">Current asset value</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìä</div>
                            <div class="card-title">Net Profit</div>
                        </div>
                        <div class="card-value" id="netProfit">$0</div>
                        <div class="card-description">This quarter</div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">Account Balances</h3>
                    <table class="table" id="ledgerTable">
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Account Code</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th>Last Transaction</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Configure your application preferences</p>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <h3 style="margin-bottom: 1rem; color: #374151;">Company Information</h3>
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" id="companyName" value="Business Pro Inc." aria-label="Company Name" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="companyEmail" value="info@businesspro.com" aria-label="Company Email" />
                        </div>
                        <button class="btn btn-primary" onclick="saveCompanyInfo()" aria-label="Save Company Information">Save Changes</button>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 1rem; color: #374151;">Notifications</h3>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="emailNotifications" checked style="margin-right: 8px;" aria-label="Enable Email Notifications" />
                                Email notifications
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="lowStockAlerts" checked style="margin-right: 8px;" aria-label="Enable Low Stock Alerts" />
                                Low stock alerts
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="paymentReminders" style="margin-right: 8px;" aria-label="Enable Payment Reminders" />
                                Payment reminders
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="saveNotificationSettings()" aria-label="Update Notification Preferences">Update Preferences</button>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 1rem; color: #374151;">User Management</h3>
                    <table class="table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Add New Product</h2>
            <form id="addProductForm">
                <div class="form-group">
                    <label class="form-label">Product Name</label>
                    <input type="text" class="form-input" id="productName" placeholder="Enter product name" aria-label="Product Name" required />
                </div>
                <div class="form-group">
                    <label class="form-label">SKU</label>
                    <input type="text" class="form-input" id="productSKU" placeholder="Enter SKU" aria-label="SKU" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <input type="text" class="form-input" id="productCategory" placeholder="Enter category" aria-label="Category" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Stock</label>
                    <input type="number" class="form-input" id="productStock" placeholder="Enter stock quantity" aria-label="Stock Quantity" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Price</label>
                    <input type="text" class="form-input" id="productPrice" placeholder="Enter price" aria-label="Price" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Product">Save Product</button>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Add New Customer</h2>
            <form id="addCustomerForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Enter customer name" aria-label="Customer Name" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="customerEmail" placeholder="Enter email" aria-label="Email" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="text" class="form-input" id="customerPhone" placeholder="Enter phone" aria-label="Phone" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Customer">Save Customer</button>
            </form>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div class="modal" id="addEmployeeModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Add New Employee</h2>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="employeeName" placeholder="Enter employee name" aria-label="Employee Name" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Position</label>
                    <input type="text" class="form-input" id="employeePosition" placeholder="Enter position" aria-label="Position" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <input type="text" class="form-input" id="employeeDepartment" placeholder="Enter department" aria-label="Department" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="employeeEmail" placeholder="Enter email" aria-label="Email" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Employee">Save Employee</button>
            </form>
        </div>
    </div>

    <!-- Add Invoice Modal -->
    <div class="modal" id="addInvoiceModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Create New Invoice</h2>
            <form id="addInvoiceForm">
                <div class="form-group">
                    <label class="form-label">Invoice #</label>
                    <input type="text" class="form-input" id="invoiceNumber" placeholder="Enter invoice number" aria-label="Invoice Number" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Customer</label>
                    <input type="text" class="form-input" id="invoiceCustomer" placeholder="Enter customer" aria-label="Customer" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="text" class="form-input" id="invoiceAmount" placeholder="Enter amount" aria-label="Amount" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="date" class="form-input" id="invoiceDueDate" aria-label="Due Date" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Invoice">Save Invoice</button>
            </form>
        </div>
    </div>

    <!-- Add Purchase Modal -->
    <div class="modal" id="addPurchaseModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Create Purchase Order</h2>
            <form id="addPurchaseForm">
                <div class="form-group">
                    <label class="form-label">PO Number</label>
                    <input type="text" class="form-input" id="purchaseNumber" placeholder="Enter PO number" aria-label="PO Number" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Supplier</label>
                    <input type="text" class="form-input" id="purchaseSupplier" placeholder="Enter supplier" aria-label="Supplier" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="text" class="form-input" id="purchaseAmount" placeholder="Enter amount" aria-label="Amount" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Expected Delivery</label>
                    <input type="date" class="form-input" id="purchaseDelivery" aria-label="Expected Delivery" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Purchase Order">Save Purchase Order</button>
            </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal" id="addExpenseModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Add New Expense</h2>
            <form id="addExpenseForm">
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="expenseDescription" placeholder="Enter description" aria-label="Description" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <input type="text" class="form-input" id="expenseCategory" placeholder="Enter category" aria-label="Category" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="text" class="form-input" id="expenseAmount" placeholder="Enter amount" aria-label="Amount" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <input type="text" class="form-input" id="expensePaymentMethod" placeholder="Enter payment method" aria-label="Payment Method" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Expense">Save Expense</button>
            </form>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Create New Task</h2>
            <form id="addTaskForm">
                <div class="form-group">
                    <label class="form-label">Task</label>
                    <input type="text" class="form-input" id="taskName" placeholder="Enter task name" aria-label="Task Name" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Assigned To</label>
                    <input type="text" class="form-input" id="taskAssignedTo" placeholder="Enter assignee" aria-label="Assigned To" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-input" id="taskPriority" aria-label="Priority" required>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="date" class="form-input" id="taskDueDate" aria-label="Due Date" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Progress</label>
                    <input type="number" class="form-input" id="taskProgress" placeholder="Enter progress (%)" aria-label="Progress" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Task">Save Task</button>
            </form>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal" id="addPaymentModal">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close Modal">√ó</button>
            <h2>Record Payment</h2>
            <form id="addPaymentForm">
                <div class="form-group">
                    <label class="form-label">Reference</label>
                    <input type="text" class="form-input" id="paymentReference" placeholder="Enter reference" aria-label="Reference" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Customer/Supplier</label>
                    <input type="text" class="form-input" id="paymentEntity" placeholder="Enter customer/supplier" aria-label="Customer/Supplier" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="text" class="form-input" id="paymentAmount" placeholder="Enter amount" aria-label="Amount" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Method</label>
                    <input type="text" class="form-input" id="paymentMethod" placeholder="Enter payment method" aria-label="Payment Method" required />
                </div>
                <button type="submit" class="btn btn-primary" aria-label="Save Payment">Save Payment</button>
            </form>
        </div>
    </div>

  <script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyCmJl82VktcyAZQYsMc_0Rw-2MxRNPBVUw",
    authDomain: "shop-mgt.firebaseapp.com",
    databaseURL: "https://shop-mgt-default-rtdb.firebaseio.com",
    projectId: "shop-mgt",
    storageBucket: "shop-mgt.firebasestorage.app",
    messagingSenderId: "577237698646",
    appId: "1:577237698646:web:185d0aeb482eb7b70713f7",
    measurementId: "G-D5YTD5M9HB"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// Utility functions
function validateFormInputs(formId) {
    const form = document.getElementById(formId);
    const inputs = form.querySelectorAll('input[required]');
    for (let input of inputs) {
        if (!input.value.trim()) {
            alert(`Please fill in ${input.previousElementSibling.textContent}`);
            return false;
        }
        if (input.type === 'number' && isNaN(input.value)) {
            alert(`${input.previousElementSibling.textContent} must be a number`);
            return false;
        }
        if (input.type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
            alert(`${input.previousElementSibling.textContent} must be a valid email`);
            return false;
        }
        if (input.type === 'date' && !input.value) {
            alert(`${input.previousElementSibling.textContent} must be a valid date`);
            return false;
        }
    }
    return true;
}

function withRetry(operation, maxRetries = 3, delay = 1000) {
    let attempts = 0;
    function attempt() {
        attempts++;
        return operation().catch(error => {
            if (attempts < maxRetries) {
                console.warn(`Retrying operation (${attempts}/${maxRetries})...`);
                return new Promise(resolve => setTimeout(resolve, delay)).then(attempt);
            }
            throw error;
        });
    }
    return attempt();
}

function checkNetwork() {
    if (!navigator.onLine) {
        alert('No internet connection. Please check your network.');
        return false;
    }
    return true;
}

// Check authentication state
document.addEventListener('DOMContentLoaded', function() {
    const loginModal = document.getElementById('loginModal');
    const container = document.querySelector('.container');
    const sidebarToggle = document.querySelector('.sidebar-toggle');

    auth.onAuthStateChanged(user => {
        if (user) {
            loginModal.style.display = 'none';
            container.style.display = 'flex';
            sidebarToggle.style.display = window.innerWidth <= 1024 ? 'block' : 'none';
            loadDashboardData();
            initializeAllTables();
            initializeSalesChart();
        } else {
            loginModal.style.display = 'flex';
            container.style.display = 'none';
            sidebarToggle.style.display = 'none';
        }
    });

    // Login form submission
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!checkNetwork()) return;
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => alert('Login failed: ' + error.message));
    });

    // Sign up button
    document.getElementById('signupButton').addEventListener('click', function() {
        if (!checkNetwork()) return;
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        auth.createUserWithEmailAndPassword(email, password)
            .then(() => {
                const userId = auth.currentUser.uid;
                database.ref(`users/${userId}`).set({
                    role: 'Administrator',
                    lastLogin: new Date().toISOString(),
                    status: 'Active'
                });
            })
            .catch(error => alert('Sign up failed: ' + error.message));
    });

    // Logout button
    document.getElementById('logoutButton').addEventListener('click', function() {
        auth.signOut();
    });

    // Navigation functionality
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page');
    const sidebar = document.getElementById('sidebar');
    const toggleButton = document.querySelector('.sidebar-toggle');

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            navLinks.forEach(l => l.classList.remove('active'));
            pages.forEach(p => p.classList.remove('active'));
            this.classList.add('active');
            const pageId = this.getAttribute('data-page');
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                smoothTransition(targetPage);
            }
            if (window.innerWidth <= 1024) {
                sidebar.classList.remove('active');
            }
        });
    });

    toggleButton.addEventListener('click', function() {
        sidebar.classList.toggle('active');
    });

    // Add loading animation to buttons
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', function() {
            if (!this.querySelector('.loading') && !this.classList.contains('modal-close')) {
                const originalText = this.innerHTML;
                this.innerHTML = '<span class="loading"></span> Processing...';
                this.disabled = true;
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 1500);
            }
        });
    });

    // Modal close functionality
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        const closeButton = modal.querySelector('.modal-close');
        closeButton.addEventListener('click', () => modal.style.display = 'none');
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
    });

    // Initialize search functionality
    addSearchFunctionality();

    // Animate numbers on dashboard
    animateNumbers();

    // Initialize intersection observer
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    const elementsToAnimate = document.querySelectorAll('.card, .table-container');
    elementsToAnimate.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        observer.observe(el);
    });

    // Add real-time clock
    setInterval(updateClock, 1000);
    updateClock();
});

// Load dashboard data
function loadDashboardData() {
    const userId = auth.currentUser.uid;
    const dashboardRef = database.ref(`users/${userId}/dashboard`);

    dashboardRef.on('value', snapshot => {
        const data = snapshot.val() || {};
        document.getElementById('totalRevenue').textContent = `$${Number(data.totalRevenue || 0).toLocaleString()}`;
        document.getElementById('totalProducts').textContent = Number(data.totalProducts || 0).toLocaleString();
        document.getElementById('totalCustomers').textContent = Number(data.totalCustomers || 0).toLocaleString();
        document.getElementById('totalOrders').textContent = Number(data.totalOrders || 0).toLocaleString();
        document.getElementById('lowStockCount').textContent = Number(data.lowStockCount || 0).toLocaleString();
        document.getElementById('todaySales').textContent = `$${Number(data.todaySales || 0).toLocaleString()}`;
        document.getElementById('todayTransactions').textContent = `${Number(data.todayTransactions || 0)} transactions`;
        document.getElementById('monthlyTarget').textContent = `${Number(data.monthlyTarget || 0)}%`;
        document.getElementById('vipCustomers').textContent = Number(data.vipCustomers || 0).toLocaleString();
        document.getElementById('totalEmployees').textContent = Number(data.totalEmployees || 0).toLocaleString();
        document.getElementById('outstandingInvoices').textContent = `$${Number(data.outstandingInvoices || 0).toLocaleString()}`;
        document.getElementById('pendingOrders').textContent = Number(data.pendingOrders || 0).toLocaleString();
        document.getElementById('monthlyExpenses').textContent = `$${Number(data.monthlyExpenses || 0).toLocaleString()}`;
        document.getElementById('overdueTasks').textContent = Number(data.overdueTasks || 0).toLocaleString();
        document.getElementById('pendingPayments').textContent = `$${Number(data.pendingPayments || 0).toLocaleString()}`;
        document.getElementById('monthlyVisitors').textContent = Number(data.monthlyVisitors || 0).toLocaleString();
        document.getElementById('conversionRate').textContent = `${Number(data.conversionRate || 0)}%`;
        document.getElementById('totalAssets').textContent = `$${Number(data.totalAssets || 0).toLocaleString()}`;
        document.getElementById('netProfit').textContent = `$${Number(data.netProfit || 0).toLocaleString()}`;
        animateNumbers();
    });
}

// Initialize all tables
function initializeAllTables() {
    const userId = auth.currentUser.uid;
    loadTableData('inventory', `users/${userId}/inventory`, renderInventoryRow);
    loadTableData('sales', `users/${userId}/sales`, renderSalesRow);
    loadTableData('customers', `users/${userId}/customers`, renderCustomerRow);
    loadTableData('employees', `users/${userId}/employees`, renderEmployeeRow);
    loadTableData('invoices', `users/${userId}/invoices`, renderInvoiceRow);
    loadTableData('purchases', `users/${userId}/purchases`, renderPurchaseRow);
    loadTableData('expenses', `users/${userId}/expenses`, renderExpenseRow);
    loadTableData('tasks', `users/${userId}/tasks`, renderTaskRow);
    loadTableData('payments', `users/${userId}/payments`, renderPaymentRow);
    loadTableData('website', `users/${userId}/website`, renderWebsiteRow);
    loadTableData('ledger', `users/${userId}/ledger`, renderLedgerRow);
    loadTableData('users', `users/${userId}/users`, renderUserRow);
}

// Load table data from Firebase
function loadTableData(tableId, refPath, renderRow) {
    const tableBody = document.querySelector(`#${tableId}Table tbody`);
    database.ref(refPath).on('value', snapshot => {
        tableBody.innerHTML = '';
        const data = snapshot.val() || {};
        Object.entries(data).forEach(([id, item]) => {
            tableBody.innerHTML += renderRow(id, item);
        });
    });
}

// Render functions for each table
function renderInventoryRow(id, item) {
    return `
        <tr>
            <td>${item.name}</td>
            <td>${item.sku}</td>
            <td>${item.category}</td>
            <td>${item.stock}</td>
            <td>$${Number(item.price).toLocaleString()}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('inventory', '${id}')" aria-label="Edit ${item.name}">Edit</button></td>
        </tr>
    `;
}

function renderSalesRow(id, item) {
    return `
        <tr>
            <td>${item.orderId}</td>
            <td>${item.customer}</td>
            <td>${item.date}</td>
            <td>$${Number(item.amount).toLocaleString()}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="viewItem('sales', '${id}')" aria-label="View Order ${item.orderId}">View</button></td>
        </tr>
    `;
}

function renderCustomerRow(id, item) {
    return `
        <tr>
            <td>${item.name}</td>
            <td>${item.email}</td>
            <td>${item.phone}</td>
            <td>${item.totalOrders}</td>
            <td>${item.lastOrder}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('customers', '${id}')" aria-label="Edit ${item.name}">Edit</button></td>
        </tr>
    `;
}

function renderEmployeeRow(id, item) {
    return `
        <tr>
            <td>${item.name}</td>
            <td>${item.position}</td>
            <td>${item.department}</td>
            <td>${item.email}</td>
            <td>${item.hireDate}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('employees', '${id}')" aria-label="Edit ${item.name}">Edit</button></td>
        </tr>
    `;
}

function renderInvoiceRow(id, item) {
    return `
        <tr>
            <td>${item.invoiceNumber}</td>
            <td>${item.customer}</td>
            <td>${item.date}</td>
            <td>$${Number(item.amount).toLocaleString()}</td>
            <td>${item.dueDate}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="viewItem('invoices', '${id}')" aria-label="View Invoice ${item.invoiceNumber}">View</button></td>
        </tr>
    `;
}

function renderPurchaseRow(id, item) {
    return `
        <tr>
            <td>${item.poNumber}</td>
            <td>${item.supplier}</td>
            <td>${item.date}</td>
            <td>$${Number(item.amount).toLocaleString()}</td>
            <td>${item.expectedDelivery}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="viewItem('purchases', '${id}')" aria-label="View Purchase Order ${item.poNumber}">View</button></td>
        </tr>
    `;
}

function renderExpenseRow(id, item) {
    return `
        <tr>
            <td>${item.date}</td>
            <td>${item.description}</td>
            <td>${item.category}</td>
            <td>$${Number(item.amount).toLocaleString()}</td>
            <td>${item.paymentMethod}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('expenses', '${id}')" aria-label="Edit ${item.description} Expense">Edit</button></td>
        </tr>
    `;
}

function renderTaskRow(id, item) {
    return `
        <tr>
            <td>${item.task}</td>
            <td>${item.assignedTo}</td>
            <td><span class="status-badge status-${item.priority.toLowerCase()}">${item.priority}</span></td>
            <td>${item.dueDate}</td>
            <td>${item.progress}%</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('tasks', '${id}')" aria-label="Edit ${item.task} Task">Edit</button></td>
        </tr>
    `;
}

function renderPaymentRow(id, item) {
    return `
        <tr>
            <td>${item.date}</td>
            <td>${item.reference}</td>
            <td>${item.entity}</td>
            <td>$${Number(item.amount).toLocaleString()}</td>
            <td>${item.method}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="viewItem('payments', '${id}')" aria-label="View Payment ${item.reference}">View</button></td>
        </tr>
    `;
}

function renderWebsiteRow(id, item) {
    return `
        <tr>
            <td>${item.page}</td>
            <td>${item.lastUpdated}</td>
            <td>${Number(item.views).toLocaleString()}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td>${item.seoScore}/100</td>
            <td><button class="btn btn-secondary" onclick="editItem('website', '${id}')" aria-label="Edit ${item.page} Page">Edit</button></td>
        </tr>
    `;
}

function renderLedgerRow(id, item) {
    return `
        <tr>
            <td>${item.account || 'N/A'}</td>
            <td>${item.accountCode || 'N/A'}</td>
            <td>${item.type || 'N/A'}</td>
            <td>$${Number(item.balance || 0).toLocaleString()}</td>
            <td>${item.lastTransaction || 'N/A'}</td>
            <td><button class="btn btn-secondary" onclick="editItem('ledger', '${id}')" aria-label="Edit ${item.account || 'Account'}">Edit</button></td>
        </tr>
    `;
}

function renderUserRow(id, item) {
    return `
        <tr>
            <td>${item.name || 'N/A'}</td>
            <td>${item.email}</td>
            <td>${item.role}</td>
            <td>${item.lastLogin}</td>
            <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
            <td><button class="btn btn-secondary" onclick="editItem('users', '${id}')" aria-label="Edit ${item.name || 'User'}">Edit</button></td>
        </tr>
    `;
}

// Show modal forms
function showAddProductForm() {
    document.getElementById('addProductModal').style.display = 'flex';
}

function showAddCustomerForm() {
    document.getElementById('addCustomerModal').style.display = 'flex';
}

function showAddEmployeeForm() {
    document.getElementById('addEmployeeModal').style.display = 'flex';
}

function showAddInvoiceForm() {
    document.getElementById('addInvoiceModal').style.display = 'flex';
}

function showAddPurchaseForm() {
    document.getElementById('addPurchaseModal').style.display = 'flex';
}

function showAddExpenseForm() {
    document.getElementById('addExpenseModal').style.display = 'flex';
}

function showAddTaskForm() {
    document.getElementById('addTaskModal').style.display = 'flex';
}

function showAddPaymentForm() {
    document.getElementById('addPaymentModal').style.display = 'flex';
}

// Save form data to Firebase
document.getElementById('addProductForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addProductForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const product = {
        name: document.getElementById('productName').value.trim(),
        sku: document.getElementById('productSKU').value.trim(),
        category: document.getElementById('productCategory').value.trim(),
        stock: Number(document.getElementById('productStock').value),
        price: Number(document.getElementById('productPrice').value.replace('$', '')),
        status: Number(document.getElementById('productStock').value) <= 20 ? 'Low Stock' : 'Active'
    };
    const path = `users/${userId}/inventory`;
    console.log(`Writing to database path: ${path}`, product);
    withRetry(() => database.ref(path).push(product))
        .then(() => {
            console.log('Product added successfully');
            document.getElementById('addProductModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding product:', error);
            alert('Error adding product: ' + error.message);
        });
});

document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addCustomerForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const customer = {
        name: document.getElementById('customerName').value.trim(),
        email: document.getElementById('customerEmail').value.trim(),
        phone: document.getElementById('customerPhone').value.trim(),
        totalOrders: 0,
        lastOrder: 'N/A',
        status: 'Active'
    };
    const path = `users/${userId}/customers`;
    console.log(`Writing to database path: ${path}`, customer);
    withRetry(() => database.ref(path).push(customer))
        .then(() => {
            console.log('Customer added successfully');
            document.getElementById('addCustomerModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding customer:', error);
            alert('Error adding customer: ' + error.message);
        });
});

document.getElementById('addEmployeeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addEmployeeForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const employee = {
        name: document.getElementById('employeeName').value.trim(),
        position: document.getElementById('employeePosition').value.trim(),
        department: document.getElementById('employeeDepartment').value.trim(),
        email: document.getElementById('employeeEmail').value.trim(),
        hireDate: new Date().toISOString().split('T')[0],
        status: 'Active'
    };
    const path = `users/${userId}/employees`;
    console.log(`Writing to database path: ${path}`, employee);
    withRetry(() => database.ref(path).push(employee))
        .then(() => {
            console.log('Employee added successfully');
            document.getElementById('addEmployeeModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding employee:', error);
            alert('Error adding employee: ' + error.message);
        });
});

document.getElementById('addInvoiceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addInvoiceForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const invoice = {
        invoiceNumber: document.getElementById('invoiceNumber').value.trim(),
        customer: document.getElementById('invoiceCustomer').value.trim(),
        date: new Date().toISOString().split('T')[0],
        amount: Number(document.getElementById('invoiceAmount').value.replace('$', '')),
        dueDate: document.getElementById('invoiceDueDate').value,
        status: 'Pending'
    };
    const path = `users/${userId}/invoices`;
    console.log(`Writing to database path: ${path}`, invoice);
    withRetry(() => database.ref(path).push(invoice))
        .then(() => {
            console.log('Invoice added successfully');
            document.getElementById('addInvoiceModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding invoice:', error);
            alert('Error adding invoice: ' + error.message);
        });
});

document.getElementById('addPurchaseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addPurchaseForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const purchase = {
        poNumber: document.getElementById('purchaseNumber').value.trim(),
        supplier: document.getElementById('purchaseSupplier').value.trim(),
        date: new Date().toISOString().split('T')[0],
        amount: Number(document.getElementById('purchaseAmount').value.replace('$', '')),
        expectedDelivery: document.getElementById('purchaseDelivery').value,
        status: 'In Transit'
    };
    const path = `users/${userId}/purchases`;
    console.log(`Writing to database path: ${path}`, purchase);
    withRetry(() => database.ref(path).push(purchase))
        .then(() => {
            console.log('Purchase added successfully');
            document.getElementById('addPurchaseModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding purchase:', error);
            alert('Error adding purchase: ' + error.message);
        });
});

document.getElementById('addExpenseForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addExpenseForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const expense = {
        date: new Date().toISOString().split('T')[0],
        description: document.getElementById('expenseDescription').value.trim(),
        category: document.getElementById('expenseCategory').value.trim(),
        amount: Number(document.getElementById('expenseAmount').value.replace('$', '')),
        paymentMethod: document.getElementById('expensePaymentMethod').value.trim(),
        status: 'Pending'
    };
    const path = `users/${userId}/expenses`;
    console.log(`Writing to database path: ${path}`, expense);
    withRetry(() => database.ref(path).push(expense))
        .then(() => {
            console.log('Expense added successfully');
            document.getElementById('addExpenseModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding expense:', error);
            alert('Error adding expense: ' + error.message);
        });
});

document.getElementById('addTaskForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addTaskForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const task = {
        task: document.getElementById('taskName').value.trim(),
        assignedTo: document.getElementById('taskAssignedTo').value.trim(),
        priority: document.getElementById('taskPriority').value,
        dueDate: document.getElementById('taskDueDate').value,
        progress: Number(document.getElementById('taskProgress').value),
        status: 'In Progress'
    };
    const path = `users/${userId}/tasks`;
    console.log(`Writing to database path: ${path}`, task);
    withRetry(() => database.ref(path).push(task))
        .then(() => {
            console.log('Task added successfully');
            document.getElementById('addTaskModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding task:', error);
            alert('Error adding task: ' + error.message);
        });
});

document.getElementById('addPaymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!checkNetwork()) return;
    if (!validateFormInputs('addPaymentForm')) return;
    const user = auth.currentUser;
    if (!user) {
        alert('User not authenticated. Please log in.');
        return;
    }
    const userId = user.uid;
    const payment = {
        date: new Date().toISOString().split('T')[0],
        reference: document.getElementById('paymentReference').value.trim(),
        entity: document.getElementById('paymentEntity').value.trim(),
        amount: Number(document.getElementById('paymentAmount').value.replace('$', '')),
        method: document.getElementById('paymentMethod').value.trim(),
        status: 'Processing'
    };
    const path = `users/${userId}/payments`;
    console.log(`Writing to database path: ${path}`, payment);
    withRetry(() => database.ref(path).push(payment))
        .then(() => {
            console.log('Payment added successfully');
            document.getElementById('addPaymentModal').style.display = 'none';
            this.reset();
            updateDashboard();
        })
        .catch(error => {
            console.error('Error adding payment:', error);
            alert('Error adding payment: ' + error.message);
        });
});

// Edit item
function editItem(section, id) {
    const userId = auth.currentUser.uid;
    database.ref(`users/${userId}/${section}/${id}`).once('value').then(snapshot => {
        const item = snapshot.val();
        if (item) {
            alert(`Edit functionality for ${section} ID ${id} is not fully implemented. Current data: ${JSON.stringify(item)}`);
        }
    });
}

// View item
function viewItem(section, id) {
    const userId = auth.currentUser.uid;
    database.ref(`users/${userId}/${section}/${id}`).once('value').then(snapshot => {
        const item = snapshot.val();
        if (item) {
            alert(`Viewing ${section} ID ${id}: ${JSON.stringify(item)}`);
        }
    });
}

// Delete item
function deleteItem(section, id) {
    if (confirm(`Are you sure you want to delete this ${section} item?`)) {
        const userId = auth.currentUser.uid;
        database.ref(`users/${userId}/${section}/${id}`).remove()
            .then(() => updateDashboard())
            .catch(error => alert(`Error deleting ${section} item: ${error.message}`));
    }
}

// Update dashboard metrics
function updateDashboard() {
    const userId = auth.currentUser.uid;
    const dashboardRef = database.ref(`users/${userId}/dashboard`);
    const updates = {};

    database.ref(`users/${userId}/inventory`).once('value').then(snapshot => {
        const items = snapshot.val() || {};
        const totalProducts = Object.keys(items).length;
        const lowStockCount = Object.values(items).filter(item => item.stock <= 20).length;
        updates.totalProducts = totalProducts;
        updates.lowStockCount = lowStockCount;

        database.ref(`users/${userId}/sales`).once('value').then(snapshot => {
            const sales = snapshot.val() || {};
            const totalOrders = Object.keys(sales).length;
            const totalRevenue = Object.values(sales).reduce((sum, sale) => sum + (sale.amount || 0), 0);
            const today = new Date().toISOString().split('T')[0];
            const todaySales = Object.values(sales).filter(sale => sale.date === today).reduce((sum, sale) => sum + (sale.amount || 0), 0);
            const todayTransactions = Object.values(sales).filter(sale => sale.date === today).length;
            const monthlyTarget = (totalRevenue / 100000) * 100;
            updates.totalOrders = totalOrders;
            updates.totalRevenue = totalRevenue;
            updates.todaySales = todaySales;
            updates.todayTransactions = todayTransactions;
            updates.monthlyTarget = Math.min(monthlyTarget, 100);

            database.ref(`users/${userId}/customers`).once('value').then(snapshot => {
                const customers = snapshot.val() || {};
                const totalCustomers = Object.keys(customers).length;
                const vipCustomers = Object.values(customers).filter(c => c.totalOrders >= 10).length;
                updates.totalCustomers = totalCustomers;
                updates.vipCustomers = vipCustomers;

                database.ref(`users/${userId}/employees`).once('value').then(snapshot => {
                    const employees = snapshot.val() || {};
                    const totalEmployees = Object.keys(employees).length;
                    updates.totalEmployees = totalEmployees;

                    database.ref(`users/${userId}/invoices`).once('value').then(snapshot => {
                        const invoices = snapshot.val() || {};
                        const outstandingInvoices = Object.values(invoices).filter(i => i.status === 'Pending').reduce((sum, i) => sum + (i.amount || 0), 0);
                        updates.outstandingInvoices = outstandingInvoices;

                        database.ref(`users/${userId}/purchases`).once('value').then(snapshot => {
                            const purchases = snapshot.val() || {};
                            const pendingOrders = Object.values(purchases).filter(p => p.status === 'In Transit').length;
                            updates.pendingOrders = pendingOrders;

                            database.ref(`users/${userId}/expenses`).once('value').then(snapshot => {
                                const expenses = snapshot.val() || {};
                                const monthlyExpenses = Object.values(expenses).reduce((sum, e) => sum + (e.amount || 0), 0);
                                updates.monthlyExpenses = monthlyExpenses;

                                database.ref(`users/${userId}/tasks`).once('value').then(snapshot => {
                                    const tasks = snapshot.val() || {};
                                    const today = new Date().toISOString().split('T')[0];
                                    const overdueTasks = Object.values(tasks).filter(t => t.dueDate < today && t.status !== 'Completed').length;
                                    updates.overdueTasks = overdueTasks;

                                    database.ref(`users/${userId}/payments`).once('value').then(snapshot => {
                                        const payments = snapshot.val() || {};
                                        const pendingPayments = Object.values(payments).filter(p => p.status === 'Processing').reduce((sum, p) => sum + (p.amount || 0), 0);
                                        updates.pendingPayments = pendingPayments;

                                        updates.monthlyVisitors = 24891;
                                        updates.conversionRate = 3.2;

                                        database.ref(`users/${userId}/ledger`).once('value').then(snapshot => {
                                            const ledger = snapshot.val() || {};
                                            const totalAssets = Object.values(ledger).reduce((sum, a) => sum + (a.balance || 0), 0);
                                            const netProfit = totalRevenue - monthlyExpenses;
                                            updates.totalAssets = totalAssets;
                                            updates.netProfit = netProfit;

                                            dashboardRef.update(updates)
                                                .catch(error => console.error('Error updating dashboard:', error));
                                        });
                                    });
                                });
                            });
                        });
                    });
                });
            });
        });
    });
}

// Save company information
function saveCompanyInfo() {
    if (!checkNetwork()) return;
    const userId = auth.currentUser.uid;
    const companyInfo = {
        companyName: document.getElementById('companyName').value.trim(),
        companyEmail: document.getElementById('companyEmail').value.trim()
    };
    database.ref(`users/${userId}/settings/companyInfo`).set(companyInfo)
        .then(() => alert('Company information saved successfully'))
        .catch(error => alert('Error saving company information: ' + error.message));
}

// Save notification settings
function saveNotificationSettings() {
    if (!checkNetwork()) return;
    const userId = auth.currentUser.uid;
    const notifications = {
        emailNotifications: document.getElementById('emailNotifications').checked,
        lowStockAlerts: document.getElementById('lowStockAlerts').checked,
        paymentReminders: document.getElementById('paymentReminders').checked
    };
    database.ref(`users/${userId}/settings/notifications`).set(notifications)
        .then(() => alert('Notification settings saved successfully'))
        .catch(error => alert('Error saving notification settings: ' + error.message));
}

// Animate numbers
function animateNumbers() {
    const numberElements = document.querySelectorAll('.card-value');
    numberElements.forEach(element => {
        const text = element.textContent;
        const number = parseInt(text.replace(/[^0-9]/g, '')) || 0;
        const prefix = text.replace(/[0-9,]/g, '');
        
        if (number > 0) {
            let current = 0;
            const increment = number / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= number) {
                    current = number;
                    clearInterval(timer);
                }
                element.textContent = prefix + Math.floor(current).toLocaleString();
            }, 30);
        }
    });
}

// Smooth transition for page changes
function smoothTransition(element) {
    element.style.opacity = '0';
    element.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        element.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
        element.style.opacity = '1';
        element.style.transform = 'translateY(0)';
    }, 100);
}

// Add search functionality
function addSearchFunctionality() {
    const tables = document.querySelectorAll('.table-container');
    tables.forEach(tableContainer => {
        if (!tableContainer.querySelector('.search-input')) {
            const table = tableContainer.querySelector('.table');
            const searchInput = document.createElement('input');
            searchInput.className = 'form-input search-input';
            searchInput.placeholder = 'Search...';
            searchInput.style.marginBottom = '1rem';
            searchInput.setAttribute('aria-label', 'Search table');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = table.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
            
            tableContainer.insertBefore(searchInput, table);
        }
    });
}

// Initialize sales chart
function initializeSalesChart() {
    if (!auth.currentUser) {
        console.warn('User not authenticated, skipping sales chart initialization');
        return;
    }
    const userId = auth.currentUser.uid;
    database.ref(`users/${userId}/sales`).on('value', snapshot => {
        const sales = snapshot.val() || {};
        const monthlySales = {};
        Object.values(sales).forEach(sale => {
            const month = sale.date ? sale.date.substring(0, 7) : null;
            if (month) {
                monthlySales[month] = (monthlySales[month] || 0) + (sale.amount || 0);
            }
        });

        const labels = Object.keys(monthlySales).sort().slice(-6);
        const data = labels.map(month => monthlySales[month]);

        const ctx = document.getElementById('salesChart').getContext('2d');
        if (ctx.chart) ctx.chart.destroy();
        ctx.chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels.map(l => new Date(l).toLocaleString('default', { month: 'short', year: 'numeric' })),
                datasets: [{
                    label: 'Sales ($)',
                    data: data,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });
    });
}

// Add real-time clock
function updateClock() {
    const now = new Date();
    let clockElement = document.querySelector('.clock');
    
    if (!clockElement) {
        clockElement = document.createElement('div');
        clockElement.className = 'clock';
        clockElement.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
            color: #374151;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        `;
        document.body.appendChild(clockElement);
    }
    
    clockElement.textContent = now.toLocaleTimeString();
}
</script>