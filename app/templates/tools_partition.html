{% extends "base.html" %}

{% block title %}Advanced Partition Calculator{% endblock %}

{% block content %}
<div class="main-container">
  <div class="header-section">
    <h1>üèóÔ∏è Advanced Partition Calculator</h1>
    <p>Calculate all materials needed for your partition wall project</p>
  </div>

  <div class="calculator-container">
    <!-- Input Section -->
    <div class="input-section">
      <h3>üìê Wall Dimensions</h3>
      <div class="input-grid">
        <div class="input-group">
          <label for="width">Wall Width (ft)</label>
          <input type="number" id="width" min="1" step="0.1" placeholder="20">
        </div>
        <div class="input-group">
          <label for="height">Wall Height (ft)</label>
          <input type="number" id="height" min="1" step="0.1" placeholder="10">
        </div>
      </div>

      <h3>üìã Board & Frame Specifications</h3>
      <div class="input-grid">
        <div class="input-group">
          <label for="boardType">Board Type</label>
          <select id="boardType">
            <option value="cement">Cement Board (8√ó4 ft)</option>
            <option value="gypsum">Gypsum Board (6√ó4 ft)</option>
            <option value="plywood">Plywood (8√ó4 ft)</option>
            <option value="osb">OSB Board (8√ó4 ft)</option>
          </select>
        </div>
        <div class="input-group">
          <label for="studType">Stud Type</label>
          <select id="studType">
            <option value="metal">Metal Channel (10 ft)</option>
            <option value="wood2x4">Wood 2√ó4 (8 ft)</option>
            <option value="wood2x6">Wood 2√ó6 (8 ft)</option>
          </select>
        </div>
      </div>

      <h3>üö™ Openings & Features</h3>
      <div class="input-grid">
        <div class="input-group">
          <label for="doors">Number of Doors</label>
          <input type="number" id="doors" min="0" max="10" value="0" placeholder="0">
        </div>
        <div class="input-group">
          <label for="windows">Number of Windows</label>
          <input type="number" id="windows" min="0" max="20" value="0" placeholder="0">
        </div>
      </div>
      <div class="input-grid">
        <div class="input-group">
          <label for="doorSize">Door Size</label>
          <select id="doorSize">
            <option value="standard">Standard (7√ó3 ft)</option>
            <option value="wide">Wide (7√ó4 ft)</option>
            <option value="double">Double (7√ó6 ft)</option>
          </select>
        </div>
        <div class="input-group">
          <label for="windowSize">Window Size</label>
          <select id="windowSize">
            <option value="small">Small (3√ó2 ft)</option>
            <option value="medium">Medium (4√ó3 ft)</option>
            <option value="large">Large (5√ó4 ft)</option>
          </select>
        </div>
      </div>

      <h3>üîß Additional Options</h3>
      <div class="checkbox-grid">
        <label class="checkbox-item">
          <input type="checkbox" id="insulation">
          <span class="checkmark"></span>
          Add Insulation
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="electrical">
          <span class="checkmark"></span>
          Electrical Wiring
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="wastage" checked>
          <span class="checkmark"></span>
          Include 10% Wastage
        </label>
        <label class="checkbox-item">
          <input type="checkbox" id="primer">
          <span class="checkmark"></span>
          Primer & Paint
        </label>
      </div>

      <button onclick="calculate()" class="calculate-btn">
        <span>üßÆ Calculate Materials</span>
      </button>
    </div>

    <!-- Results Section -->
    <div id="results" class="results-section">
      <h3>üìä Material Requirements</h3>
      <div id="results-content"></div>
    </div>
  </div>
</div>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .main-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 1rem;
  }

  .header-section {
    text-align: center;
    color: white;
    margin-bottom: 2rem;
    padding: 2rem 0;
  }

  .header-section h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .header-section p {
    font-size: 1.2rem;
    opacity: 0.9;
  }

  .calculator-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: start;
  }

  .input-section, .results-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    border: 1px solid rgba(255,255,255,0.2);
  }

  .input-section h3, .results-section h3 {
    color: #4a5568;
    margin: 1.5rem 0 1rem 0;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .input-section h3:first-child {
    margin-top: 0;
  }

  .input-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
  }

  .input-group label {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  input, select {
    padding: 0.875rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }

  input:focus, select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
  }

  .checkbox-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 0.75rem;
    border-radius: 10px;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .checkbox-item:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .checkbox-item input[type="checkbox"] {
    display: none;
  }

  .checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e0;
    border-radius: 6px;
    margin-right: 0.75rem;
    position: relative;
    transition: all 0.3s ease;
  }

  .checkbox-item input[type="checkbox"]:checked + .checkmark {
    background: #667eea;
    border-color: #667eea;
  }

  .checkbox-item input[type="checkbox"]:checked + .checkmark::after {
    content: '‚úì';
    position: absolute;
    color: white;
    font-size: 14px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .calculate-btn {
    width: 100%;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
  }

  .calculate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 15px 30px rgba(76, 175, 80, 0.4);
  }

  .calculate-btn:active {
    transform: translateY(0);
  }

  .results-section {
    min-height: 400px;
    display: none;
  }

  .results-section.show {
    display: block;
    animation: slideInRight 0.5s ease-out;
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .material-card {
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-left: 5px solid #667eea;
    transition: all 0.3s ease;
  }

  .material-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  }

  .material-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .material-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #2d3748;
  }

  .material-quantity {
    font-size: 1.5rem;
    font-weight: 800;
    color: #667eea;
  }

  .material-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.75rem;
    font-size: 0.9rem;
    color: #4a5568;
  }

  .cost-summary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 15px;
    padding: 1.5rem;
    margin-top: 1.5rem;
    text-align: center;
  }

  .cost-summary h4 {
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
  }

  .total-cost {
    font-size: 2rem;
    font-weight: 800;
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .calculator-container {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .header-section h1 {
      font-size: 2rem;
    }
  }

  @media (max-width: 768px) {
    .main-container {
      padding: 0.5rem;
    }

    .header-section {
      padding: 1.5rem 0;
    }

    .header-section h1 {
      font-size: 1.8rem;
    }

    .header-section p {
      font-size: 1rem;
    }

    .input-section, .results-section {
      padding: 1.5rem;
      border-radius: 15px;
    }

    .input-grid {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .checkbox-grid {
      grid-template-columns: 1fr;
    }

    .material-details {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .input-section, .results-section {
      padding: 1rem;
    }

    .header-section h1 {
      font-size: 1.5rem;
    }

    input, select {
      padding: 0.75rem;
    }

    .calculate-btn {
      padding: 0.875rem 1.5rem;
      font-size: 1rem;
    }
  }

  @media (max-height: 600px) and (orientation: landscape) {
    .header-section {
      padding: 1rem 0;
    }

    .calculator-container {
      grid-template-columns: 1fr 1fr;
    }
  }
</style>

<script>
  function calculate() {
    // Get input values
    const width = parseFloat(document.getElementById('width').value);
    const height = parseFloat(document.getElementById('height').value);
    const boardType = document.getElementById('boardType').value;
    const studType = document.getElementById('studType').value;
    const doors = parseInt(document.getElementById('doors').value) || 0;
    const windows = parseInt(document.getElementById('windows').value) || 0;
    const doorSize = document.getElementById('doorSize').value;
    const windowSize = document.getElementById('windowSize').value;
    
    // Options
    const insulation = document.getElementById('insulation').checked;
    const electrical = document.getElementById('electrical').checked;
    const wastage = document.getElementById('wastage').checked;
    const primer = document.getElementById('primer').checked;

    if (!width || !height || width <= 0 || height <= 0) {
      alert("Please enter valid wall dimensions.");
      return;
    }

    // Board specifications
    const boardSpecs = {
      cement: { w: 4, h: 8, name: "Cement Board", price: 25 },
      gypsum: { w: 4, h: 6, name: "Gypsum Board", price: 18 },
      plywood: { w: 4, h: 8, name: "Plywood", price: 35 },
      osb: { w: 4, h: 8, name: "OSB Board", price: 22 }
    };

    // Stud specifications
    const studSpecs = {
      metal: { length: 10, spacing: 2, name: "Metal Channel", price: 8 },
      wood2x4: { length: 8, spacing: 16/12, name: "Wood 2√ó4", price: 6 },
      wood2x6: { length: 8, spacing: 16/12, name: "Wood 2√ó6", price: 9 }
    };

    // Opening sizes
    const doorSizes = {
      standard: { w: 3, h: 7 },
      wide: { w: 4, h: 7 },
      double: { w: 6, h: 7 }
    };

    const windowSizes = {
      small: { w: 2, h: 3 },
      medium: { w: 3, h: 4 },
      large: { w: 4, h: 5 }
    };

    // Calculate areas
    const wallArea = width * height;
    const doorArea = doors * doorSizes[doorSize].w * doorSizes[doorSize].h;
    const windowArea = windows * windowSizes[windowSize].w * windowSizes[windowSize].h;
    const netArea = wallArea - doorArea - windowArea;
    const totalBoardArea = netArea * 2; // Both sides

    // Board calculations
    const board = boardSpecs[boardType];
    const boardArea = board.w * board.h;
    let boardsNeeded = Math.ceil(totalBoardArea / boardArea);

    // Stud calculations
    const stud = studSpecs[studType];
    const studsCount = Math.ceil(width / stud.spacing) + 1;
    const totalStudLength = studsCount * height;
    let studsNeeded = Math.ceil(totalStudLength / stud.length);

    // Track and channel calculations
    const trackLength = width * 2; // Top and bottom
    let tracksNeeded = Math.ceil(trackLength / stud.length);

    // Door/window framing
    const doorFraming = doors * 3; // 3 pieces per door
    const windowFraming = windows * 4; // 4 pieces per window
    const framingPieces = doorFraming + windowFraming;

    // Screws and fasteners
    const screwsPerBoard = 25;
    const totalScrews = Math.ceil((boardsNeeded * screwsPerBoard) / 100) * 100; // Boxes of 100

    // Insulation (if selected)
    let insulationBatts = 0;
    if (insulation) {
      const cavityArea = netArea * 0.85; // Account for studs
      insulationBatts = Math.ceil(cavityArea / 32); // 32 sq ft per batt
    }

    // Electrical (if selected)
    let electricalBoxes = 0;
    let wireLength = 0;
    if (electrical) {
      electricalBoxes = Math.ceil(width / 8) * 2; // Every 8 feet, both sides
      wireLength = Math.ceil(width * 1.5); // 1.5x wall width
    }

    // Apply wastage
    if (wastage) {
      boardsNeeded = Math.ceil(boardsNeeded * 1.1);
      studsNeeded = Math.ceil(studsNeeded * 1.1);
      tracksNeeded = Math.ceil(tracksNeeded * 1.1);
      insulationBatts = Math.ceil(insulationBatts * 1.1);
    }

    // Calculate costs
    const boardCost = boardsNeeded * board.price;
    const studCost = (studsNeeded + tracksNeeded) * stud.price;
    const screwCost = Math.ceil(totalScrews / 100) * 8;
    const insulationCost = insulation ? insulationBatts * 12 : 0;
    const electricalCost = electrical ? (electricalBoxes * 3 + wireLength * 2) : 0;
    const primerCost = primer ? Math.ceil(totalBoardArea / 350) * 45 : 0;

    const totalCost = boardCost + studCost + screwCost + insulationCost + electricalCost + primerCost;

    // Display results
    const resultsContent = document.getElementById('results-content');
    resultsContent.innerHTML = `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üìã ${board.name}</span>
          <span class="material-quantity">${boardsNeeded}</span>
        </div>
        <div class="material-details">
          <div><strong>Coverage:</strong> ${totalBoardArea.toFixed(1)} sq ft</div>
          <div><strong>Size:</strong> ${board.w}√ó${board.h} ft</div>
          <div><strong>Cost:</strong> Rs${boardCost}</div>
        </div>
      </div>

      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üîß ${stud.name} (Studs)</span>
          <span class="material-quantity">${studsNeeded}</span>
        </div>
        <div class="material-details">
          <div><strong>Spacing:</strong> ${(stud.spacing * 12).toFixed(0)}"</div>
          <div><strong>Length:</strong> ${stud.length} ft each</div>
          <div><strong>Cost:</strong> Rs${studCost}</div>
        </div>
      </div>

      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üîß Track Channels</span>
          <span class="material-quantity">${tracksNeeded}</span>
        </div>
        <div class="material-details">
          <div><strong>Purpose:</strong> Top & Bottom</div>
          <div><strong>Length:</strong> ${stud.length} ft each</div>
          <div><strong>Included in stud cost</strong></div>
        </div>
      </div>

      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üî© Screws</span>
          <span class="material-quantity">${Math.ceil(totalScrews / 100)} boxes</span>
        </div>
        <div class="material-details">
          <div><strong>Total screws:</strong> ${totalScrews}</div>
          <div><strong>Box size:</strong> 100 pcs</div>
          <div><strong>Cost:</strong> Rs${screwCost}</div>
        </div>
      </div>

      ${doors > 0 ? `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üö™ Door Openings</span>
          <span class="material-quantity">${doors}</span>
        </div>
        <div class="material-details">
          <div><strong>Size each:</strong> ${doorSizes[doorSize].w}√ó${doorSizes[doorSize].h} ft</div>
          <div><strong>Area removed:</strong> ${doorArea.toFixed(1)} sq ft</div>
          <div><strong>Extra framing:</strong> ${doorFraming} pieces</div>
        </div>
      </div>` : ''}

      ${windows > 0 ? `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">ü™ü Window Openings</span>
          <span class="material-quantity">${windows}</span>
        </div>
        <div class="material-details">
          <div><strong>Size each:</strong> ${windowSizes[windowSize].w}√ó${windowSizes[windowSize].h} ft</div>
          <div><strong>Area removed:</strong> ${windowArea.toFixed(1)} sq ft</div>
          <div><strong>Extra framing:</strong> ${windowFraming} pieces</div>
        </div>
      </div>` : ''}

      ${insulation ? `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üß± Insulation Batts</span>
          <span class="material-quantity">${insulationBatts}</span>
        </div>
        <div class="material-details">
          <div><strong>Coverage:</strong> Rs{(insulationBatts * 32).toFixed(1)} sq ft</div>
          <div><strong>Type:</strong> Fiberglass R-13</div>
          <div><strong>Cost:</strong> Rs${insulationCost}</div>
        </div>
      </div>` : ''}

      ${electrical ? `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">‚ö° Electrical Components</span>
          <span class="material-quantity">${electricalBoxes} boxes</span>
        </div>
        <div class="material-details">
          <div><strong>Wire needed:</strong> ${wireLength} ft</div>
          <div><strong>Outlet boxes:</strong> ${electricalBoxes}</div>
          <div><strong>Cost:</strong> $${electricalCost}</div>
        </div>
      </div>` : ''}

      ${primer ? `
      <div class="material-card">
        <div class="material-header">
          <span class="material-title">üé® Primer & Paint</span>
          <span class="material-quantity">${Math.ceil(totalBoardArea / 350)} gallons</span>
        </div>
        <div class="material-details">
          <div><strong>Coverage:</strong> ${totalBoardArea.toFixed(1)} sq ft</div>
          <div><strong>Type:</strong> Primer + Paint</div>
          <div><strong>Cost:</strong> Rs${primerCost}</div>
        </div>
      </div>` : ''}

      <div class="cost-summary">
        <h4>üí∞ Total Estimated Cost</h4>
        <div class="total-cost">Rs${totalCost.toLocaleString()}</div>
        <p style="margin-top: 0.5rem; opacity: 0.9;">
          ${wastage ? 'Includes 10% wastage allowance' : 'Excludes wastage allowance'}
        </p>
      </div>
    `;

    document.getElementById('results').classList.add('show');
  }
</script>
{% endblock %}